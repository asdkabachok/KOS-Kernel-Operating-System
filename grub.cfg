# Конфигурация GRUB2 для загрузки ядра KOS
# Использует протокол Multiboot2

# Устанавливаем тайм-аут меню (в секундах)
set timeout=5

# Устанавливаем цветовую схему меню
set menu_color_normal=white/black
set menu_color_highlight=black/light-gray

# Основная запись меню для загрузки ядра
menuentry "KOS - Kernel OS" {
    # Загрузка ядра по протоколу Multiboot2
    # Ядро загружается по адресу 0x100000 (1 MB), как указано в linker.ld
    multiboot2 /boot/kos.bin

    # Устанавливаем видеорежим VBE для графического framebuffer
    # 1920x1080, 32-битный цвет
    set gfxmode=1920x1080
    set gfxpayload=keep

    # Загружаем модуль VBE для поддержки графики
    insmod all_video

    # Устанавливаем видеорежим через GRUB
    terminal_output gfxterm

    # Сообщение загрузки
    echo "Loading KOS Kernel..."
}

# Дополнительная запись для отладки с отключением ACPI
menuentry "KOS - Kernel OS (Safe Mode)" {
    multiboot2 /boot/kos.bin acpi=off
    set gfxmode=1024x768
    set gfxpayload=keep
    insmod all_video
    terminal_output gfxterm
    echo "Loading KOS Kernel (Safe Mode)..."
}

# Запись для восстановления (recovery mode)
menuentry "KOS - Kernel OS (Recovery)" {
    multiboot2 /boot/kos.bin acpi=off edd=off
    set gfxmode=800x600
    set gfxpayload=keep
    insmod all_video
    terminal_output gfxterm
    echo "Loading KOS Kernel (Recovery Mode)..."
}

# Подменю для дополнительных параметров
submenu "Advanced Options" {
    # Загрузка с отладочным последовательным портом
    menuentry "KOS - Kernel OS (Serial Debug)" {
        multiboot2 /boot/kos.bin debug=serial
        set gfxmode=auto
        insmod all_video
        terminal_output gfxterm
        echo "Loading KOS Kernel with Serial Debug..."
    }

    # Загрузка с отключением APIC
    menuentry "KOS - Kernel OS (No APIC)" {
        multiboot2 /boot/kos.bin noapic
        set gfxmode=auto
        insmod all_video
        terminal_output gfxterm
        echo "Loading KOS Kernel (No APIC)..."
    }
}
